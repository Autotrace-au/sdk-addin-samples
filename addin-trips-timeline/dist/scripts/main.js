"use strict";geotab.addin.tripsTimeline=function(){var t=void 0,e=void 0,n=document.getElementById("tripstimeline-chart-container"),i=document.getElementById("tripstimeline-chart-prev"),o=document.getElementById("tripstimeline-chart-next"),r=void 0,a=new Date,u=new Date,d=144e5,c=72e5,s=[],f={},l=!1,v=!1,m=null,g=function(e,n){return new Promise(function(i){t.call("Get",{typeName:"Trip",search:{fromDate:e.toISOString(),toDate:n.toISOString()}},i)})["catch"](function(t){return alert(t),[]})},h=function(t,e){g(t,e).then(function(t){var e=void 0,n=void 0,i=void 0,o=void 0,a=void 0;for(i=0;i<t.length;i++)e=t[i],n=l[e.device.id],n&&!f[e.id]&&(f[e.id]=!0,o=new Date(e.start),a=new Date(e.stop),s.push({id:e.id,content:n.name+"<br>"+E(o,a)+S(o,a,n),start:o,end:a}));r.setItems(s),r.redraw()})},w=function(t){if(r){var e=r.getWindow(),n=e.end-e.start;r.setWindow({start:e.start.valueOf()+t*n*.5,end:e.end.valueOf()+t*n*.5})}},p=function(){n.style.width=n.parentNode.offsetWidth-i.offsetWidth-o.offsetWidth-20+"px"},D=function(){r=new vis.Timeline(n,[],{orientation:"top",zoomMin:144e5,zoomMax:144e5,minHeight:180}),r.on("rangechange",function(t){var e=void 0;t.start.valueOf()-a.valueOf()<c&&(e=a,a=new Date(a.valueOf()-d),h(a,e)),u.valueOf()-t.end.valueOf()<c&&(e=u,u=new Date(u.valueOf()+d),h(a,e))});var t=function(){m||(w(-1),m=window.setInterval(function(){w(-1)},200))},e=function(){m||(w(1),m=window.setInterval(function(){w(1)},200))},s=function(){m&&(window.clearInterval(m),m=null)},f=function(){var t=!0;try{document.createEvent("TouchEvent")}catch(e){t=!1}return t}();f?i.addEventListener("touchstart",t,!1):i.addEventListener("mousedown",t,!1),f?o.addEventListener("touchstart",e,!1):o.addEventListener("mousedown",e,!1),document.body.addEventListener("mouseup",s,!1),f&&document.body.addEventListener("touchend",s,!1),p()},I=function(){return l?(s=[],f={},a=new Date(r.range.start-d),u=new Date(r.range.start+d),p(),h(a,u),!0):(O(),v=!0,!1)},O=function(){return t.call("Get",{typeName:"Device",resultsLimit:1e3,search:{groups:e.getGroupFilter?e.getGroupFilter():[{id:"GroupCompanyId"}],fromDate:(new Date).toISOString}},function(t){var e={},n=void 0;for(n=0;n<t.length;n++)e[t[n].id]=t[n];l=e,v&&(I(),v=!1)},function(t){alert(t)}),!1},y=function(t){var e=""+t.getHours(),n=""+t.getMinutes();return 1===e.length&&(e="0"+e),1===n.length&&(n="0"+n),e+":"+n},E=function(t,e){return y(t)+" - "+y(e)},S=function(t,e,n){return"<a href=\"#tripsHistory,dateRange:(endDate:'' + end.toISOString() + '',startDate:'' + start.toISOString() + ''),devices:!("+n.id+')" class="geotabButtonIcons externalLink detailslink" target="_blank"></a>'},L=function(){s=[],f={},l=!1};return{initialize:function(n,i,o){t=n,e=i,D(),o&&o()},focus:function(n,i){t=n,e=i,l=!1,I()},blur:function(){L()}}};