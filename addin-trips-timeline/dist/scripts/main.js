"use strict";geotab.addin.tripsTimeline=function(){var t=void 0,e=void 0,n=document.getElementById("tripstimeline-chart-container"),i=document.getElementById("tripstimeline-chart-prev"),r=document.getElementById("tripstimeline-chart-next"),o=void 0,a=new Date,u=new Date,d=144e5,c=72e5,s=[],f={},l=!1,v=!1,g=null,m=function(e,n){return new Promise(function(i){t.call("Get",{typeName:"Trip",search:{fromDate:e.toISOString(),toDate:n.toISOString()}},i)})["catch"](function(t){return alert(t),[]})},h=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},p=function(t,e){m(t,e).then(function(t){var e=void 0,n=void 0,i=void 0,r=void 0,a=void 0;for(i=0;i<t.length;i++)e=t[i],n=l[e.device.id],n&&!f[e.id]&&(f[e.id]=!0,r=new Date(e.start),a=new Date(e.stop),s.push({id:e.id,content:h(n.name)+"<br>"+S(r,a)+L(r,a,n),start:r,end:a}));o.setItems(s),o.redraw()})},w=function(t){if(o){var e=o.getWindow(),n=e.end-e.start;o.setWindow({start:e.start.valueOf()+t*n*.5,end:e.end.valueOf()+t*n*.5})}},D=function(){n.style.width=n.parentNode.offsetWidth-i.offsetWidth-r.offsetWidth-20+"px"},I=function(){o=new vis.Timeline(n,[],{orientation:"top",zoomMin:144e5,zoomMax:144e5,minHeight:180}),o.on("rangechange",function(t){var e=void 0;t.start.valueOf()-a.valueOf()<c&&(e=a,a=new Date(a.valueOf()-d),p(a,e)),u.valueOf()-t.end.valueOf()<c&&(e=u,u=new Date(u.valueOf()+d),p(a,e))});var t=function(){g||(w(-1),g=window.setInterval(function(){w(-1)},200))},e=function(){g||(w(1),g=window.setInterval(function(){w(1)},200))},s=function(){g&&(window.clearInterval(g),g=null)},f=function(){var t=!0;try{document.createEvent("TouchEvent")}catch(e){t=!1}return t}();f?i.addEventListener("touchstart",t,!1):i.addEventListener("mousedown",t,!1),f?r.addEventListener("touchstart",e,!1):r.addEventListener("mousedown",e,!1),document.body.addEventListener("mouseup",s,!1),f&&document.body.addEventListener("touchend",s,!1),D()},O=function(){return l?(s=[],f={},a=new Date(o.range.start-d),u=new Date(o.range.start+d),D(),p(a,u),!0):(y(),v=!0,!1)},y=function(){return t.call("Get",{typeName:"Device",resultsLimit:1e3,search:{groups:e.getGroupFilter?e.getGroupFilter():[{id:"GroupCompanyId"}],fromDate:(new Date).toISOString}},function(t){var e={},n=void 0;for(n=0;n<t.length;n++)e[t[n].id]=t[n];l=e,v&&(O(),v=!1)},function(t){alert(t)}),!1},E=function(t){var e=""+t.getHours(),n=""+t.getMinutes();return 1===e.length&&(e="0"+e),1===n.length&&(n="0"+n),e+":"+n},S=function(t,e){return E(t)+" - "+E(e)},L=function(t,e,n){return"<a href=\"#tripsHistory,dateRange:(endDate:'' + end.toISOString() + '',startDate:'' + start.toISOString() + ''),devices:!("+n.id+')" class="geotabButtonIcons externalLink detailslink" target="_blank"></a>'},b=function(){s=[],f={},l=!1};return{initialize:function(n,i,r){t=n,e=i,I(),r&&r()},focus:function(n,i){t=n,e=i,l=!1,O()},blur:function(){b()}}};