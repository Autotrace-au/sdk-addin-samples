"use strict";var angularObj={app:null,initAngular:function(){var e=document.getElementById("importKmlZones");angularObj.app=angular.module("importKMLZones",[]),angularObj.app.directive("modalDialog",function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(t,n,o){t.dialogStyle={},o.width&&(t.dialogStyle.width=o.width),o.height&&(t.dialogStyle.height=o.height),t.hideModal=function(){t.show=!1,e.style.overflow="",e.style.height="auto"}},template:"<div class='ng-modal' ng-show='show'><div class='ng-modal-overlay' ng-click='hideModal()'></div><div class='ng-modal-dialog' ng-style='dialogStyle'><div class='ng-modal-close' ng-click='hideModal()'>X</div><div class='ng-modal-dialog-content' ng-transclude></div></div></div>"}}),angularObj.app.service("clearService",function(){var e={};return e.clear=function(){kml.clear()},e}),angularObj.app.controller("optionsController",["$scope","clearService",function(t,n){t.modalShown=!1,t.toggleModal=function(){var n=function(n){t.zoneTypeOptions=[],kml.prevSelectedTypes=[],n.forEach(function(e){t.zoneTypeOptions.push({id:e.id,name:e.name,isSystem:!!e.isSystem&&e.isSystem,comment:e.comment?e.comment:""})}),t.$apply(),kml.options.zoneTypes.every(function(t,n){var o=e.querySelector("#typesSelect");return t!==kml.defaultZoneType||o.selectedIndex!==-1||(o.selectedIndex=n,!1)})};kml.api.call("Get",{typeName:"ZoneType"},function(e){n(kml.addSystemZoneTypes(e,!0))},function(){n(kml.addSystemZoneTypes([],!0))}),t.colorPickerValue=kml.colorPicker.getPicker().getHexValue(),t.transparencySliderValue=t.transparencySliderValue||kml.colorPicker.getDefaultTransparencyValue(),kml.utils.inputTypeSupport("range","a")&&(e.querySelector(".vanillaSlider").value=t.transparencySliderValue),angular.element(e.querySelector("input.vanillaSlider")).on("input",function(n){var o=n.target.value;t.transparencySliderValue=Number(o),kml.colorPicker.getTransparencyControl().set({a:o}),e.querySelector("#colorPickerField").style.opacity=(100-o)/100,t.$apply()});var o=e.querySelector("#colorPickerField");kml.utils.inputTypeSupport("color","hello world")?angular.element(o).on("change",function(){kml.colorPicker.getPicker().setValue(kml.utils.hexToRGBArray(this.value))}):(angular.element(o).on("focus",function(){kml.colorPicker.getPicker().originalPicker.showPicker(this)}),angular.element(o).on("blur",function(){var e=kml.colorPicker.getPicker().originalPicker.valueElement.value;kml.colorPicker.getPicker().originalPicker.pickerIsActive===!1?kml.colorPicker.getPicker().originalPicker.hidePicker():(t.colorPickerValue=e,this.value=e,this.style.backgroundColor=e,t.$apply(),this.focus())})),t.modalShown=!t.modalShown,t.modalShown===!0&&(e.style.overflow="hidden",e.style.height="100%")},t.setQuickColor=function(e){t.colorPickerValue=kml.colorPicker.setQuickColor(e)},t.changeZoneStop=function(e){e.target.checked||e.preventDefault();for(var t=e.target.parentNode.querySelectorAll(".geotabSwitchButton"),n=0;n<t.length;n++)t[n].id!==e.target.id&&(t[n].checked=!1);e.target.checked=!0},t.applyOptions=function(){kml.applyOptions(),e.style.overflow="",e.style.height="auto",t.modalShown=!1},t.setDefaultOptions=function(){kml.setDefaultOptions(),t.colorPickerValue=kml.colorPicker.getDefaultColorHex(),t.transparencySliderValue=kml.colorPicker.getDefaultTransparencyValue(),kml.utils.inputTypeSupport("range","a")&&(e.querySelector(".vanillaSlider").value=t.transparencySliderValue)},t.clear=function(){n.clear()},t.selectType=function(t){var n,o=null,r=e.querySelector("#typesSelect");for(kml.prevSelectedTypes=kml.prevSelectedTypes||[],setTimeout(function(){for(n=0;n<kml.prevSelectedTypes.length;n++)r.options[kml.prevSelectedTypes[n]].selected=!0;null!==o&&(r.options[o].selected=!1)},0),kml.selectedTypes=r.selectedOptions||kml.utils.getSelectValues(r),n=0;n<kml.selectedTypes.length;n++)kml.prevSelectedTypes.indexOf(kml.selectedTypes[n].index)===-1&&kml.prevSelectedTypes.push(kml.selectedTypes[n].index);t.target.selected?(o=t.target.index,kml.prevSelectedTypes.splice(kml.prevSelectedTypes.indexOf(o),1)):o=null}}]),angularObj.app.controller("parsedDataController",["$scope","clearService",function(e,t){e.uploaderTitle=kml.isFormDataSupported?"Drop your files here or click to select them":"Click here to choose kml file",e.importSelectedZones=function(){kml.importZones()},e.hideImported=function(e){kml.hideImported(e)},e.exportKML=function(){kml.exportKML()},e.selectAll=function(e){kml.selectAll(e)},e.uploadFiles=function(e){var n=e.target.files;t.clear(),kml.parseFiles(n)}}])}};!function(){var e={api:null,state:null,args:{},item:null,childCallback:{},minDate:new Date(Date.UTC(1986,0,1)),defaultZoneSize:200,localInit:["addressLookup","Address Lookup","customer","Customer","office","Office","home","Home"],isFormDataSupported:!!window.FormData,fileReader:null,filter:null,colorPickerObj:null,zoneCreator:null,options:{},zonesData:{zones:[],commonStyles:[]},uploader:null,utils:null,colorPicker:null,vanillaSlider:null,waiting:null,importedInBG:[],itemsPerCall:50,defaultZoneType:"ZoneTypeCustomerId",initVariables:function(e,t){var n=this;this.api=e,this.state=t,this.args.container=document.getElementById("importKmlZones"),this.local=this.setupLocal(this.localInit),this.filter=t.getGroupFilter(),this.utils=new Utils,this.fileReader="undefined"!=typeof FileReader?new FileReader:null,this.uploader=new Uploader,this.vanillaSlider=new VanillaSlider,this.waiting=new Waiting,Array.prototype.forEach.call(this.args.container.parentNode.getElementsByClassName("extern"),function(e){e.id&&(n.args[e.id]=e)}),this.colorPicker=new ColorPicker,this.colorPickerObj=this.colorPicker.formColorPicker(),this.zoneCreator=this.zoneShapeCreator(),this.options={zoneTypes:[this.defaultZoneType],zoneSize:this.defaultZoneSize,zoneColor:this.colorPickerObj.value(),zoneShape:!1,stoppedInsideZones:this.args.container.querySelector("#stoppedInsideZones").checked}},NOOP:function(){},setupLocal:function(e){var t,n,o={};if(e.length%2!==0)throw new Error("incorrect data items");for(t=0;t<e.length;t+=2){if(n=e[t],o[n])throw new Error(n+" already added");o[n]=e[t+1]}return o},addSystemZoneTypes:function(e,t){var n,o,r,l,i={ZoneTypeAddressLookupId:this.local.addressLookup,ZoneTypeCustomerId:this.local.customer,ZoneTypeOfficeId:this.local.office,ZoneTypeHomeId:this.local.home},a=!1;for(n=0,o=e.length;n<o;n+=1)l=e[n],r=l.id||l,l.id||(t&&"ZoneTypeAddressLookupId"===r?(e.splice(n,1),n-=1,o-=1):(a=!0,e[n]={id:l,name:i[r],isSystem:!0}));if(!a)for(var s in i)!i.hasOwnProperty(s)||t&&"ZoneTypeAddressLookupId"===s||e.push({id:s,name:i[s],comment:this.localInit.systemAssignedComment,isSystem:!0});return e},zoneShapeCreator:function(){var e=function(e,t,n){var o,r=n/2||9e-4,l=[[1,1],[-1,1],[-1,-1],[1,-1]],i=[];for(o=0;o<l.length;o++)i.push({x:t+l[o][0]*r,y:e+l[o][1]*r/1.5});return i},t=function(e,t,n){var o,r,l,i=n/2,a=8e-5/n,s=i-a*n,c=2*Math.sqrt(i*i-s*s),u=Math.ceil(Math.PI/Math.asin(c/(2*i))),d=u<20?20:u+1,p=2*Math.PI/(d-1),m=0,f=[];for(l=0;l<d;l++)r=e+i*Math.cos(m),o=t+i*Math.sin(m)/Math.abs(Math.cos(r*Math.PI/180)),f.push({x:o,y:r}),m+=p;return f},n=function(e){return 360*e/40075e3};return{getZonePoints:function(o,r,l,i){var a=l?n(l):.0018;return i?t(o,r,a):e(o,r,a)}}},parseFiles:function(e){var t=this,n=e.length,o=0;0!==n&&(this.waiting.show(),this.fileReader.onload=function(r){var l,i,a,s=r.target.result,c=new DOMParser,u=c.parseFromString(s,"text/xml");if(t.isFileDataValid(u,e[o].name)){for(l=u.documentElement.querySelectorAll("Placemark"),i=u.documentElement.querySelectorAll("Style"),a=0;a<l.length;a++)t.zonesData.zones.push(l[a]);for(a=0;a<i.length;a++)i[a].id&&(t.zonesData.commonStyles[i[a].id]=i[a])}o++,o<n?t.fileReader.readAsText(e[o]):o===n&&t.populateZoneTables(),t.waiting.hide()},this.fileReader.readAsText(e[0]))},isFileDataValid:function(e,t){var n=e.documentElement.querySelector("Placemark");return"kml"===e.documentElement.tagName.toLowerCase()&&n?0===n.getElementsByTagName("name").length?(this.utils.showError("Name field required in "+t+"."),!1):!(!this.isPoint(n)&&!this.isPolygon(n))||(this.utils.showError(t+" must content a point or polygon data."),!1):(this.utils.showError("File '"+t+"' content format is incorrect."),!1)},populateZoneTables:function(){var e=this,t=!1,n=function(e){var t,n={valid:!0,message:""},o=function(e,t,n){return!!(!isNaN(e)&&e>=t&&e<=n)};for(0===e.name.length&&(n.valid=!1,n.message+="Zone name can not be empty. "),0===e.points.length&&(n.valid=!1,n.message+="Zone coordinates can not be empty. "),t=0;t<e.points.length;t++)o(e.points[t].y,-90,90)||(n.valid=!1,n.message+="Latitude coordinate value = "+e.points[t].y+" is incorrect. "),o(e.points[t].x,-180,180)||(n.valid=!1,n.message+="Longitude coordinate value = "+e.points[t].x+" is incorrect. ");return n};this.zonesData.zones.forEach(function(o,r){o.zoneParameters=e.getZoneParameters(o);var l,i,a,s,c=o.zoneParameters.isPolygon?e.args.container.querySelector("#polygonList table"):e.args.container.querySelector("#pointList table"),u=n(o.zoneParameters);"none"===c.parentNode.style.display&&(c.parentNode.style.display=""),l=document.createElement("tr"),l.id="row"+r,i=document.createElement("td"),c.querySelector("tbody").appendChild(l),l.appendChild(i),i.textContent=o.zoneParameters.name,i=i.cloneNode(),i.textContent=o.zoneParameters.comment||"-",l.appendChild(i),i=i.cloneNode(),o.zoneParameters.colorFromOptions?i.textContent="Set by options.":(s=document.createElement("div"),s.className="colorDiv",s.style.backgroundColor=e.utils.rgbToHex.apply(e.utils,e.utils.colorObjToArr(o.zoneParameters.fillColor)),s.style.opacity=o.zoneParameters.fillColor.a/255,i.appendChild(s)),l.appendChild(i),i=i.cloneNode(),u.valid===!0?(t=!0,a=document.createElement("input"),a.type="checkbox",a.id=r,a.className="importCheckbox",a.checked=!0,i.appendChild(a)):(l.className="error",e.args.container.querySelector("#exportKML").style.display="",i.textContent=u.message),l.appendChild(i)}),t===!0&&(this.args.container.querySelector("#importButton").style.display="",this.args.container.querySelector("#selectAll").checked=!0,this.args.container.querySelector("#selectAllLabel").style.display="")},isPoint:function(e){var t=e.getElementsByTagName("Point");return t.length>0&&t[0].getElementsByTagName("coordinates").length>0},isPolygon:function(e){var t=e.getElementsByTagName("Polygon"),n=t.length>0?t[0].getElementsByTagName("outerBoundaryIs"):[],o=n.length>0?n[0].getElementsByTagName("LinearRing"):[];return t.length>0&&n.length>0&&o.length>0&&o[0].getElementsByTagName("coordinates").length>0},getZoneParameters:function(e){var t,n=e.getElementsByTagName("description"),o=e.getElementsByTagName("Style").length>0?e.getElementsByTagName("Style")[0]:null,r=e.getElementsByTagName("styleUrl").length>0?e.getElementsByTagName("styleUrl")[0].textContent.replace("#",""):null,l=r?this.zonesData.commonStyles[r]:null,i=o||l,a=!0;if(i){var s=i.getElementsByTagName("PolyStyle"),c=s&&s.length>0?s[0].querySelector("color").textContent.replace("#","").trim():null;if(c){var u=c.slice(-2)+c.slice(4,6)+c.slice(2,4),d=c.slice(0,2),p=this.utils.hexToRGBArray(u);t={r:p[0],g:p[1],b:p[2],a:parseInt(d,16)},a=!1}}return{activeFrom:this.minDate,activeTo:new Date(2050,0,1),comment:n.length>0?this.utils.decodeHTMLEntities(n[0].textContent):"",displayed:!0,externalReference:"",fillColor:a?this.options.zoneColor:t,colorFromOptions:a,groups:this.filter,name:this.utils.decodeHTMLEntities(e.getElementsByTagName("name")[0].textContent.trim()),points:this.getPoints(e),zoneTypes:this.options.zoneTypes,zoneSize:this.options.zoneSize,zoneShape:this.options.zoneShape,mustIdentifyStops:this.options.stoppedInsideZones,isPolygon:this.isPolygon(e),isPoint:this.isPoint(e)}},getPoints:function(e){var t="",n=[],o=function(e,t,n,o){var r=6371,l=function(e){return e*(Math.PI/180)},i=l(n-e),a=l(o-t),s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(l(e))*Math.cos(l(n))*Math.sin(a/2)*Math.sin(a/2),c=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return r*c};if(this.isPoint(e))t=e.querySelector("coordinates").textContent,n=this.zoneCreator.getZonePoints(1*t.split(",")[1],1*t.split(",")[0],this.options.zoneSize,this.options.zoneShape);else if(this.isPolygon(e)){var r=e.getElementsByTagName("Polygon")[0],l=r.getElementsByTagName("outerBoundaryIs"),i=r.getElementsByTagName("innerBoundaryIs");if(l.length>0&&i.length>0){var a=l[0].querySelector("coordinates"),s=i[0].querySelector("coordinates"),c=a.textContent.trim().split(/\s/),u=s.textContent.trim().split(/\s/),d=null,p=0,m=0,f=function(e,t,o){for(var r=e;r<t;r++)o[r].length>0&&n.push({x:o[r].split(",")[0],y:o[r].split(",")[1]})};c.forEach(function(e,t){e.length>0&&(e=e.split(","),u.forEach(function(n,r){n.length>0&&(n=n.split(","),null===d?d=o(e[0],e[1],n[0],n[1]):d>o(e[0],e[1],n[0],n[1])&&(d=o(e[0],e[1],n[0],n[1]),p=t,m=r))}))}),f(0,p+1,c),f(m,u.length,u),f(1,m+1,u),f(p,c.length,c)}else l.length>0&&0===i.length&&(t=l[0].querySelector("coordinates"),t.textContent.trim().split(/\s/).forEach(function(e){e.length>0&&n.push({x:e.split(",")[0],y:e.split(",")[1]})}))}return n},markRowSuccess:function(e,t){var n=document.getElementById("row"+e),o=document.createElement("a"),r=document.createElement("button"),l=document.createElement("span");n.className="imported",n.lastChild.textContent="Zone successfully imported.",l.className="geotabButtonIcons iconSearch",r.appendChild(l),r.style["float"]="right",r.className="geotabButton emptyButton",o.appendChild(r),o.href="#map,zones:!((id:"+t+"))",n.firstChild.appendChild(o)},markRowError:function(e,t){var n=document.getElementById("row"+e);n.className="error",n.lastChild.textContent=t},updateControlsVisibility:function(e){if(!this.args.container)return!1;var t=this.args.container.querySelectorAll(".imported"),n=this.args.container.querySelectorAll(".error");t.length>0&&(this.args.container.querySelector("#hideImportedLabel").style.display=""),n.length>0&&(this.args.container.querySelector("#exportKML").style.display=""),e&&this.args.container.querySelector("#importButton").removeAttribute("disabled"),0===this.args.container.getElementsByClassName("importCheckbox").length&&(this.args.container.querySelector("#selectAllLabel").style.display="none")},saveZones:function(e){var t=this,n=[],o=[],r=0,l=0,i=function(n){if(l++,t.waiting.updateProgressBar(100*n/e.length),l===o.length){t.waiting.hideProgressBar();var r=t.args.container.querySelector("#importButton");r&&r.removeAttribute("disabled")}else a(o[l]);t.updateControlsVisibility()},a=function(e){t.api.multiCall(e,function(n){e.every(function(e,o){var r="string"==typeof n?n:n[o];return t.args.container?t.markRowSuccess(e[1].entity.rowId,r):t.importedInBG.push({rowId:e[1].entity.rowId,id:r}),!0}),i(e.length)},function(n){e.every(function(e){return t.args.container?t.markRowError(e[1].entity.rowId,n):t.importedInBG.push({rowId:e[1].entity.rowId,message:n}),!0}),i(e.length)})};return 0===e.length?void alert("No selected zones to import."):(e.every(function(e){return r<t.itemsPerCall?r++:(o.push(n),n=[],r=1),n.push(["Add",{typeName:"Zone",entity:e}]),!0}),n.length>0&&o.push(n),this.args.container.querySelector("#importButton").setAttribute("disabled","disabled"),this.waiting.showProgressBar(),void a(o[0]))},updateImportedInBG:function(){var e=this;this.importedInBG.every(function(t){return void 0!==t.id?e.markRowSuccess(t.rowId,t.id):void 0!==t.message&&e.markRowError(t.rowId,t.message),!0}),this.updateControlsVisibility(!0),this.importedInBG=[]},importZones:function(){for(var e=this.args.container.getElementsByClassName("importCheckbox"),t=[],n=0;n<e.length;n++)e[n].checked&&(t.push(this.zonesData.zones[e[n].id].zoneParameters),t[t.length-1].rowId=e[n].id);this.saveZones(t)},hideImported:function(e){var t,n=this.args.container.getElementsByClassName("imported");if(e.currentTarget.checked===!0)for(t=0;t<n.length;t++)n[t].style.display="none";else for(t=0;t<n.length;t++)n[t].style.display=""},exportKML:function(){var e,t,n=this,o=this.args.container.querySelectorAll(".checkmateListTable .error"),r="",l="download"in document.createElement("a"),i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;for(e=0;e<o.length;e++){var a=this.zonesData.zones[o[e].id.replace("row","")];r+=(new XMLSerializer).serializeToString(a)}r='<?xml version="1.0" encoding="UTF-8"?>\n<kml>'+r+"</kml>",navigator.saveBlob=navigator.saveBlob||navigator.msSaveBlob||navigator.mozSaveBlob||navigator.webkitSaveBlob,window.saveAs=window.saveAs||window.webkitSaveAs||window.mozSaveAs||window.msSaveAs,i&&(window.saveAs||navigator.saveBlob)?t=function(e,t){var n,o=new i;o.append(e),n=o.getBlob("text/plain; charset=UTF-8"),window.saveAs?window.saveAs(n,t):navigator.saveBlob(n,t)}:l&&(t=function(e,t){var o=document.createElement("a");o.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(r)),o.setAttribute("download",t),o.style.display="none",n.args.container.appendChild(o),o.click(),n.args.container.removeChild(o)}),t?t(r,"not_imported.kml"):alert("Your browser does not support any method of saving JavaScript gnerated data to files.")},selectAll:function(e){var t,n=document.getElementsByClassName("importCheckbox");for(t=0;t<n.length;t++)n[t].checked=!!e.currentTarget.checked},clearDataTables:function(){var e=this,t=function(t){var n=e.args.container.querySelector("#"+t+" table"),o=n.querySelectorAll("tr");if(o.length>2)for(var r=2;r<o.length;r++)o[r].parentNode.removeChild(o[r]);"none"!==n.parentNode.style.display&&(n.parentNode.style.display="none",e.args.container.querySelector("#importButton").style.display="none",e.args.container.querySelector("#hideImportedLabel").style.display="none",e.args.container.querySelector("#progressContainer").style.display="none",e.args.container.querySelector("#exportKML").style.display="none")};t("polygonList"),t("pointList"),this.args.container.querySelector("#selectAll").checked=!1,this.args.container.querySelector("#selectAllLabel").style.display="none",this.utils.hideError()},applyOptions:function(){var e=this,t=this.args.container.querySelector("#typesSelect").selectedOptions||this.utils.getSelectValues(this.args.container.querySelector("#typesSelect")),n=[],o=this.args.container.querySelector("#optionsControllerElement"),r=angular.element(o).scope().zoneTypeOptions;t.forEach(function(e){r.every(function(t){return t.id!==e.value||(n.push(t.isSystem===!0?t.id:t),!1)})}),this.options.zoneTypes=n,this.options.zoneColor=this.colorPickerObj.value(),this.options.transparencyValue=this.colorPicker.getTransparencyControl().get(),this.options.stoppedInsideZones=this.args.container.querySelector("#stoppedInsideZones").checked,this.zonesData.zones.forEach(function(t){t.zoneParameters=e.getZoneParameters(t)})},setDefaultOptions:function(){for(var e=this.args.container.querySelector("#typesSelect"),t=this.args.container.querySelector("#colorPickerField"),n=0;n<e.options.length;n++)e.options[n].selected=e.options[n].value===this.defaultZoneType;this.colorPicker.setDefaultColor(),t.value=this.colorPicker.getDefaultColorHex(),t.style.opacity=this.colorPicker.getDefaultColor()[3]/255,this.args.container.querySelector("#stoppedInsideZonesNo").checked=!1,this.args.container.querySelector("#stoppedInsideZones").checked=!0},clear:function(){this.uploader.clear(),this.zonesData.zones=[],this.zonesData.commonStyles=[],this.clearDataTables()}},t=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.kml=e}(),function(){var e=function(){var e="http://www.w3.org/2000/svg",t={path:!0,circle:!0,svg:!0,rect:!0,text:!0};return{vanilla:function(){var n=function(e){var t="string"==typeof e.className?e:e.className,n="string"==typeof e.className?"className":"baseVal";return{get:function(){return t[n]},set:function(e){t[n]=e}}},o=function(e,t){return n(e).get().indexOf(t)!==-1},r=function(e,t){if(e.classList)e.classList.add(t);else{var o=n(e);o.get().indexOf(t)<0&&o.set(o.get()+(o.get()?" ":"")+t)}},l=function(e){return Object.prototype.toString.call(e).indexOf("Array")!==-1},i=function(e){return Object.prototype.toString.call(e).indexOf("Object")!==-1},a=function(n){return t.hasOwnProperty(n.toLowerCase())?document.createElementNS(e,n):document.createElement(n)},s=function(e,t){return e.style.display=t,e},c=function(e){var t;return e.currentStyle?e.currentStyle.display:window.getComputedStyle?(t=window.getComputedStyle(e,null),t.getPropertyValue("display")):void 0},u=function(e){var t,n,o,r=document.body;return"none"!==c(e)?e:(s(e,""),"none"===c(e)&&(t=e.nodeName,n=document.createElement(t),r.appendChild(n),o=c(n),"none"===o&&(o="block"),r.removeChild(n),s(e,o)),e)},d=function(e){return s(e,"none")},p={addClasses:function(e,t){var n,o=t.split(" ");for(n=0;n<o.length;n++)r(e,o[n])},hasClass:o,css:function(e,t){var n=function(e,t){return function(n){e.style[n]=t[n]}};Object.keys(t).forEach(n(e,t))},create:function(e,t,n){var o=a((e||"").toUpperCase()),r=function(t,n){return function(o){try{t.setAttribute(o,n[o])}catch(r){throw new Error("Try to set "+o+" attribute "+n[o]+" to "+t.tagName+" ("+e+"). Connected with this error: "+r.message)}}};return t&&Object.keys(t).forEach(r(o,t)),n&&p.css(o,n),o},extend:function(){var e,t,n,o,r,a=arguments.length,s=!1,c=arguments[0],u=1;for("boolean"==typeof c&&(s=c,c=arguments[1],u++);u!==a;){for(e=arguments[u],t=Object.keys(e),r=0;r<t.length;r++)n=e[t[r]],s&&(i(n)||l(n))?(o=c[t[r]],o=c[t[r]]=i(o)||l(o)?o:l(n)?[]:{},p.extend(s,o,n)):c[t[r]]=e[t[r]];u++}return c},isArray:l,show:u,hide:d,toggle:function(e,t){t?this.show(e):this.hide(e)},closest:function(e,t){var n=e&&(e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector);if(n)for(;e&&e!==document.body;){if(n.bind(e)(t))return e;e=e.parentNode}return!1},offset:function(e){var t,n=0,o=0,r={left:0,top:0};if(null!==e){for(t=e;null!==t;)n+=t.offsetLeft,o+=t.offsetTop,t=t.offsetParent;r.left=n,r.top=o}return r}};return p}(),slider:function n(e,t){var o={max:100,min:0,step:5,value:0},r=window.document.body,l=kml.utils.isBrowserSupportTouchEvents(),i=t?Object.keys(t).reduce(function(e,n){return e[n]=t[n],e},o):o,n=(kml.utils.inputTypeSupport("range","a")?function(e){var t=e.appendChild(kml.vanillaSlider.vanilla.create("INPUT",{"class":"vanillaSlider",type:"range",max:i.max,min:i.min,step:i.step,value:i.value,"ng-model":"sliderValue"})),n=kml.utils.NOOP;return kml.slider=t,"function"==typeof i.onChange&&(n=i.onChange,t.addEventListener("change",function(e){n.call(this,this.value,e)},!1),t.addEventListener("input",function(e){n.call(this,this.value,e)},!1)),{set:function(e,n){t[e]=n},get:function(e){return t[e]},disable:function(){t.setAttribute("disabled","disabled")},enable:function(){t.removeAttribute("disabled")}}}:function(e){var t,n=kml.utils.NOOP,o=e.appendChild(kml.vanillaSlider.vanilla.create("SPAN",{"class":"vanillaSliderElement"})),a=o.offsetWidth/2,s=e.offsetWidth,c=0,u=0,d=i.max,p=i.min,m=i.step,f=d-p,h=f/m,g=s/h,y=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!1),t},v=function(e,t){var r=g&&Math.round(Math.abs(e)/g)*m,l="number"==typeof t?t:c;return r&&(u=e<0?Math.max(p,l-r):Math.min(d,l+r),u=Math.round(u/m)*m,k(u),n.call(o,u)),u},k=function(e){o.style.left=(e-p)/f*100+"%"},S={start:l?"touchstart":"mousedown",move:l?"touchmove":"mousemove",end:l?"touchend":"mouseup"},b=0,w=function(e){v(e.pageX-b)},C=function(e){var t;e.target!==o&&(t=this.getBoundingClientRect(),g=t.width/h,c=v(e.pageX-t.left,0))},T=function(e){var n;if("changedTouches"in e){if(1!==e.changedTouches.length)return!0;n=e.changedTouches[0]}else n=e;return t[e.type].call(this,n,e)},P=function(){c=u,o.dispatchEvent(y("blur")),r.removeEventListener(S.move,T,!1),r.removeEventListener(S.end,T,!1)},E=function(t,n){n.preventDefault(),b=t.pageX,s=e.offsetWidth,g=s/h,a=o.offsetWidth/2,o.dispatchEvent(y("focus")),r.addEventListener(S.move,T,!1),r.addEventListener(S.end,T,!1)};return t={mousedown:E,touchstart:E,mousemove:w,touchmove:w,mouseup:P,touchend:P},kml.vanillaSlider.vanilla.addClasses(e,"vanillaSlider"),o.addEventListener(S.start,T,!1),e.addEventListener("click",C,!1),o.style.left=-a+"px","function"==typeof i.onChange&&(n=i.onChange),i.value&&(c=Math.max(Math.min(i.value,d),p),k(c)),{set:function(e,t){c=Math.max(Math.min(t,d),p),k(c),n.call(o,c)},get:function(){return c},disable:function(){o.removeEventListener(S.start,T,!1),e.removeEventListener("click",C,!1),P()},enable:function(){o.addEventListener(S.start,T,!1),e.addEventListener("click",C,!1)}}})(e),a=!1;return{getValue:function(){return n.get("value")},setValue:function(e){return e<i.min&&(e=i.min),e>i.max&&(e=i.max),n.set("value",e),e},disable:function(){a||(n.disable(),a=!0)},enable:function(){a&&(n.enable(),a=!1)}}}}},t=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.VanillaSlider=e}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e=function(){var e=kml.args.container.querySelector("#errorMessage");return{inputTypeSupport:function(e,t){var n=document.createElement("input");return n.setAttribute("type",e),n.setAttribute("value",t),n.type===e&&n.value!==t},isBrowserSupportTouchEvents:function(){var e=!0;try{document.createEvent("TouchEvent")}catch(t){e=!1}return e},colorObjToArr:function(e){return Array.isArray(e)?e:[e.r,e.g,e.b,e.a]},rgbToHex:function(e,t,n){return"object"===("undefined"==typeof e?"undefined":_typeof(e))?kml.rgbToHex.apply(this,[e.r,e.g,e.b]):"#"+[e,t,n].map(function(e){var t=(e||0).toString(16);return t.length<2?"0"+t:t}).join("")},hexToRGBArray:function(e){var t=this.normalizeHexColor(e),n=function(e){return parseInt(t.slice(e,e+2),16)};return[n(0),n(2),n(4)]},normalizeHexColor:function(e){return e.replace("#","").replace(/^(.)(.)(.)$/,"$1$1$2$2$3$3")},showError:function(t){e.textContent=t,e.style.display=""},hideError:function(){"none"!==e.style.display&&(e.style.display="none")},getSelectValues:function(e){for(var t,n=[],o=e&&e.options,r=0,l=o.length;r<l;r++)t=o[r],t.selected&&n.push({value:t.value});return n},decodeHTMLEntities:function(e){var t=document.createElement("a");return e&&"string"==typeof e&&(e=e.replace(/&amp;nbsp;/g,"")),t.innerHTML=e,t.textContent}}},t=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.Utils=e}(),function(){var e=this,t=function(){var t=null,n=null,o=null,r=[255,69,0,38],l="#FF4500",i={r:255,g:69,b:0,a:38},a=85,s=null,c=function(){t=kml.args.container.querySelector("#colorPicker").querySelectorAll(".quickColorsBox"),o=kml.utils.colorObjToArr(i||r),n=function(e){var t=e.getElementsByClassName("transparencySlider")[0],n=e.getElementsByClassName("transparencyButtonSet")[0],r=function(){var t=e.getElementsByClassName("transparencySliderValue")[0],n=e.getElementsByClassName("transparencySliderControl")[0],r=function(e){return Math.round(100-100*(e<=1?e:e/255))},l=kml.vanillaSlider.slider(n,{min:0,max:100,step:5,value:t.textContent=r(o[3])});return{get:function(){return l?Math.round((100-l.getValue())/100*255):0},set:function(e){l.setValue((e.a?e.a:e[3])||0)}}},l=function(e,t){t.parentNode.removeChild(t),e.style.display="block"},i=r();return l(t,n),i}(kml.args.container.querySelector("#colorPicker"))};return{getDefaultColor:function(){return r},getDefaultColorHex:function(){return l},getTransparencyControl:function(){return n},getDefaultTransparencyValue:function(){return a},getPicker:function(){return s},setVariables:c,formColorPicker:function(){c();var l=["#ff4500","#ffa500","#008000","#ffff00","#ADD8E6","#0000ff","#800080"],i=[],a=function(){return kml.args.container.querySelector("#colorPicker INPUT:not([type='radio'])")},u=function(e){var t="string"==typeof e?kml.utils.hexToRGBArray(e):e,n=kml.utils.colorObjToArr(t);for(Math.max.apply(Math,n)>1&&(n=n.map(function(e){return"undefined"==typeof e?1:e/255}));n.length<4;)n.push(0);return n.slice()},d=function(e){i.forEach(function(t){"change"===t.eventType&&t.callback(e)})},p=function(){var t=kml.utils.inputTypeSupport("color","hello world"),n=function(){var t=a();return t.type="color",t.addEventListener("change",function(){d(e.value)},!1),{setValue:function(e){var n=kml.utils.rgbToHex.apply(kml,kml.utils.colorObjToArr(e));t.value=n,t.style.opacity=kml.utils.colorObjToArr(e)[3]/255,d(n)},getValue:function(){return kml.utils.hexToRGBArray(t.value)},getHexValue:function(){return t.value}}},o=function(){var t=a(),n=jscolor,o=new n(t);return o.valueElement.addEventListener("change",function(){d("#"+e.value)},!1),{setValue:function(e){var t=e.length>3?e.slice(0,3):e,n=e.length>3?e.slice(3,4):255*kml.utils.colorObjToArr(r)[3],l=kml.utils.rgbToHex.apply(kml.utils,kml.utils.colorObjToArr(t));o.fromRGB.apply(o,u(t)),a().style.opacity=n/255,a().style.backgroundColor=l,d(l)},getValue:function(){return(o.rgb||r).map(function(e){return 255*e})},getHexValue:function(){return t.value},originalPicker:o}};return(t?n:o)()},m=function(e,t){i.push({eventType:e,callback:t})};return s=p(),s.setValue(o),l.forEach(function(e){var n=document.createElement("div");n.className="quickColor",n.setAttribute("ng-click","setQuickColor($event)"),n.style.backgroundColor=e,t[0].appendChild(n)}),{value:function(e){var t=void 0;return e?(s.setValue(e),n.set(e),e):(t=s.getValue(),{r:t[0],g:t[1],b:t[2],a:n.get()})},attachEvent:m}},setQuickColor:function(e){if(e.target.style.backgroundColor){var t=e.target.style.backgroundColor,o=t.indexOf("#")<0?/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g.exec(t).splice(1):kml.utils.hexToRGBArray(t),r=[];r.push(parseInt(o[0],10)),r.push(parseInt(o[1],10)),r.push(parseInt(o[2],10)),r.push(n.get()),s.setValue(r),kml.args.container.querySelector("#colorPickerField").value=s.getHexValue()}},setDefaultColor:function(){s.setValue(r)}}},n=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):n.ColorPicker=t}(),function(){var e=function(){var e=null,t=null;return{init:function(){e=kml.args.container.getElementsByClassName("dragAndDropUploader")[0],t=e.className;var n=e.getElementsByTagName("input")[0];e.ondragover=function(){return angular.injector(["ng","importKMLZones"]).get("clearService").clear(),e.className=t+" hoverArea",!1},e.ondragleave=function(){return e.className=t,!1},e.ondrop=function(n){n.preventDefault(),e.className=t;var o=n.dataTransfer.files;kml.parseFiles(o)},e.onclick=function(){n.click()}},clear:function(){e.className=t}}},t=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.Uploader=e}(),function(){var e=function(){var e=kml.args.container.querySelector("#waiting"),t={lines:13,length:24,width:14,radius:42,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"},n=e,o=new Spinner(t),r=kml.args.container.querySelector("#progressContainer"),l=kml.args.container.querySelector("#importProgress");return{show:function(){e.style.display="",o.spin(n)},hide:function(){e.style.display="none",o.stop()},showProgressBar:function(){r.style.display="",kml.args.container.style.overflow="hidden",kml.args.container.style.height="100%",l.value="0"},hideProgressBar:function(){setTimeout(function(){r&&(r.style.display="none",kml.args.container.style.overflow="",kml.args.container.style.height="auto")},400)},updateProgressBar:function(e){l&&(l.value+=e)}}},t=function(){return this||(0,
eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.Waiting=e}();