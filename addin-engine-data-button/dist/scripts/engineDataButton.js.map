{"version":3,"sources":["engineDataButton.js"],"names":["geotab","customButtons","engineDataButton","event","api","state","preventDefault","diagnostics","device","pageState","getState","id","length","dateRange","date","Date","interval","endDate","getTime","startDate","toISOString","messenger","text","timer","mainContainer","textContainer","closeIcon","addAttributes","element","attrs","a","hasOwnProperty","setAttribute","addCss","styles","style","createElement","elemName","css","appendTo","elem","document","appendChild","destroy","clearInterval","undefined","removeEventListener","parentNode","removeChild","getMainContent","querySelector","createMainContent","body","innerHTML","addEventListener","showMessage","setInterval","gotoPage","diagnostic"],"mappings":"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","file":"engineDataButton.js","sourcesContent":["/**\r\n * The function is called whenever the Add-In button is clicked.\r\n *\r\n * @param {object} event - The event dispatched from the button click.\r\n * @param {object} api - The GeotabApi object for making calls to MyGeotab.\r\n * @param {object} state - The page state object allows access to URL, page navigation and global group filter.\r\n */\r\ngeotab.customButtons.engineDataButton = (event, api, state) => {\r\n  'use strict';\r\n\r\n  event.preventDefault();\r\n\r\n  // The diagnostic ids to display the data of\r\n  let diagnostics = [\r\n    'DiagnosticEngineSpeedId',\r\n    'DiagnosticGoDeviceVoltageId',\r\n    'DiagnosticDeviceTotalFuelId'\r\n  ];\r\n\r\n  // The currently selected device from state\r\n  let device = (() => {\r\n    let pageState = state.getState();\r\n    return (pageState && pageState.id && pageState.id.length) ? pageState.id : null;\r\n  })();\r\n\r\n  // The date range which will be used on engine data profile\r\n  let dateRange = (() => {\r\n    let date = new Date(),\r\n      interval = 60 * 60 * 24 * 1000,   // a day\r\n      endDate = new Date(date.getTime() - interval);\r\n    return {\r\n      startDate: endDate.toISOString(),\r\n      endDate: date.toISOString()\r\n    };\r\n  })();\r\n\r\n  // Displays messages to the UI\r\n  let messenger = (() => {\r\n    const text = 'Select any vehicle first';\r\n\r\n    let timer;\r\n    let mainContainer;\r\n    let textContainer;\r\n    let closeIcon;\r\n\r\n    let addAttributes = function (element, attrs) {\r\n      for (let a in attrs) {\r\n        if (attrs.hasOwnProperty(a)) {\r\n          element.setAttribute(a, attrs[a]);\r\n        }\r\n      }\r\n    };\r\n\r\n    let addCss = function (element, styles) {\r\n      for (let a in styles) {\r\n        if (styles.hasOwnProperty(a)) {\r\n          element.style[a] = styles[a];\r\n        }\r\n      }\r\n    };\r\n\r\n    let createElement = function (elemName, attrs, css, appendTo) {\r\n      let elem = document.createElement(elemName);\r\n\r\n      if (attrs) {\r\n        addAttributes(elem, attrs);\r\n      }\r\n\r\n      if (css) {\r\n        addCss(elem, css);\r\n      }\r\n\r\n      if (appendTo) {\r\n        appendTo.appendChild(elem);\r\n      }\r\n\r\n      return elem;\r\n    };\r\n\r\n    let destroy = () => {\r\n      if (timer) {\r\n        clearInterval(timer);\r\n        timer = undefined;\r\n      }\r\n\r\n      if (closeIcon) {\r\n        closeIcon.removeEventListener('click', destroy, false);\r\n      }\r\n\r\n      if (mainContainer && mainContainer.parentNode) {\r\n        mainContainer.parentNode.removeChild(mainContainer);\r\n      }\r\n\r\n      mainContainer = undefined;\r\n      textContainer = undefined;\r\n      closeIcon = undefined;\r\n    };\r\n\r\n    let getMainContent = () => {\r\n      return document.querySelector('#engineDataButton-addin');\r\n    };\r\n\r\n    let createMainContent = () => {\r\n      mainContainer = createElement('div', {\r\n        id: 'engineDataButton-addin'\r\n      }, {\r\n          'border': '1px solid #ffeb94',\r\n          'background-color': '#fffcdd',\r\n          'color': '#222',\r\n          'margin': '0 auto 0 auto',\r\n          'position': 'relative',\r\n          'width': '600px',\r\n          'top': 0,\r\n          'right': '0',\r\n          'z-index': '10004',\r\n          'table-layout': 'fixed',\r\n          'opacity': 0.9,\r\n          'text-align': 'center'\r\n        }, document.body);\r\n\r\n      mainContainer.destroy = destroy;\r\n\r\n      textContainer = createElement('h2', null, {\r\n        'display': 'inline-block',\r\n        'margin': '5px 0',\r\n        'word-wrap': 'break-word',\r\n        'font-weight': 'normal',\r\n        'font-size': '1.5em',\r\n        'color': '#222',\r\n        'text-align': 'center'\r\n      }, mainContainer);\r\n\r\n      textContainer.innerHTML = text;\r\n\r\n      closeIcon = createElement('span', null, {\r\n        'float': 'right',\r\n        'margin-top': '9px',\r\n        'font-size': '20px',\r\n        'width': '30px',\r\n        'position': 'relative',\r\n        'top': '-0.1em',\r\n        'left': '-0.1em',\r\n        'font-family': 'arial',\r\n        'font-style': 'normal',\r\n        'font-weight': 'bold',\r\n        'cursor': 'pointer',\r\n        'display': 'inline-block',\r\n        'text-decoration': 'none',\r\n        'text-align': 'center',\r\n        'vertical-align': 'middle',\r\n        'overflow': 'hidden',\r\n        'font-variant': 'normal',\r\n        'text-transform': 'none',\r\n        'color': '#222'\r\n      }, mainContainer);\r\n\r\n      closeIcon.innerHTML = 'x';\r\n      closeIcon.addEventListener('click', destroy, false);\r\n    };\r\n\r\n    return {\r\n      /**\r\n       * Shows a message to the UI\r\n       */\r\n      showMessage: () => {\r\n        mainContainer = getMainContent();\r\n        if (!mainContainer) {\r\n          createMainContent();\r\n          timer = setInterval(destroy, 5000);\r\n        }\r\n      },\r\n      /**\r\n       * Destorys the current message\r\n       */\r\n      destroy: () => {\r\n        mainContainer = mainContainer || getMainContent();\r\n        if (mainContainer) {\r\n          mainContainer.destroy();\r\n        }\r\n      }\r\n    };\r\n  })();\r\n\r\n  if (device && device !== 'all') {\r\n    messenger.destroy();\r\n\r\n    // redirect to the engine data profile page passing in arguments for device, date range and diagnostics to display\r\n    state.gotoPage('engineDataProfile', {\r\n      dateRange: dateRange,\r\n      device: [device],\r\n      diagnostic: diagnostics\r\n    });\r\n  } else {\r\n    messenger.showMessage();\r\n  }\r\n};\r\n"]}