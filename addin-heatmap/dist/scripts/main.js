"use strict";geotab.addin.heatmap=function(){var e=void 0,t=void 0,n=void 0,a=void 0,o=void 0,i=void 0,d=void 0,u=void 0,l=function(e){d.innerHTML=e},r=function(e){e?u.style.display="block":setTimeout(function(){u.style.display="none"},600)},c=function(){var d=a.value,u=o.value,c=i.value;if(l(""),null!==d&&""!==u&&""!==c){r(!0);var g=new Date(u).toISOString(),m=new Date(c).toISOString();e.call("Get",{typeName:"LogRecord",resultsLimit:1e4,search:{deviceSearch:{id:d},fromDate:g,toDate:m}},function(e){for(var a=[],o=[],i=0;i<e.length;i++)0===e[i].latitude&&0===e[i].longitude||(a.push({lat:e[i].latitude,lon:e[i].longitude,value:1}),o.push(new L.LatLng(e[i].latitude,e[i].longitude)));a.length>0?(t.fitBounds(o),n.setLatLngs(a)):l("Not enough data to display"),r(!1)},function(e){l(e),r(!1)})}},g=function(e){t=new L.Map("heatmap-map").setView(new L.LatLng(e.latitude,e.longitude),13),L.tileLayer("https://api.mapbox.com/styles/v1/mapbox/streets-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZ2VvdGFiIiwiYSI6ImNpd2NlaW02MjAxc28yeW9idTR3dmRxdTMifQ.ZH0koA2g2YMMBOcx6EYbwQ").addTo(t),n=L.heatLayer({radius:{value:24,absolute:!1},opacity:.7,gradient:{.45:"rgb(0,0,255)",.55:"rgb(0,255,255)",.65:"rgb(0,255,0)",.95:"yellow",1:"rgb(255,0,0)"}}).addTo(t),a=document.getElementById("heatmap-vehicles"),o=document.getElementById("heatmap-from"),i=document.getElementById("heatmap-to"),d=document.getElementById("heatmap-error"),u=document.getElementById("heatmap-loading");var l=new Date,r=l.getDate(),g=l.getMonth()+1,m=l.getFullYear();r<10&&(r="0"+r),g<10&&(g="0"+g),o.value=m+"-"+g+"-"+r+"T00:00",i.value=m+"-"+g+"-"+r+"T23:59",document.getElementById("heatmap-vehicles").addEventListener("change",function(e){e.preventDefault(),c()}),document.getElementById("heatmap-from").addEventListener("change",function(e){e.preventDefault(),c()}),document.getElementById("heatmap-to").addEventListener("change",function(e){e.preventDefault(),c()})},m=function(e,t){return e=e.name.toLowerCase(),t=t.name.toLowerCase(),e===t?0:e>t?1:-1};return{initialize:function(t,n,a){e=t,"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(e){g(e.coords),a()}):(g({longitude:-79.709441,latitude:43.434497}),a())},focus:function(n,o){e=n,e.call("Get",{typeName:"Device",resultsLimit:1e3,search:{fromDate:(new Date).toISOString(),groups:o.getGroupFilter()}},function(e){!e||e.length<0||(e.sort(m),e.forEach(function(e){var t=new Option;t.text=e.name,t.value=e.id,a.add(t)}))},l),setTimeout(function(){t.invalidateSize()},200)}}};