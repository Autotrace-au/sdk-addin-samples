"use strict";geotab.addin.heatmap=function(){var i,l,u,d,r,c,g,s,m=function(e){g.innerHTML=e},f=function(e){e?s.style.display="block":setTimeout(function(){s.style.display="none"},600)},v=function(){var e=d.value,t=r.value,n=c.value;if(m(""),null!==e&&""!==t&&""!==n){f(!0);var o=new Date(t).toISOString(),a=new Date(n).toISOString();i.call("Get",{typeName:"LogRecord",resultsLimit:1e4,search:{deviceSearch:{id:e},fromDate:o,toDate:a}},function(e){for(var t=[],n=[],o=0;o<e.length;o++)0===e[o].latitude&&0===e[o].longitude||(t.push({lat:e[o].latitude,lon:e[o].longitude,value:1}),n.push(new L.LatLng(e[o].latitude,e[o].longitude)));0<t.length?(l.fitBounds(n),u.setLatLngs(t)):m("Not enough data to display"),f(!1)},function(e){m(e),f(!1)})}},o=function(e){l=new L.Map("heatmap-map",{center:new L.LatLng(e.latitude,e.longitude),zoom:13}),L.tileLayer("https://api.mapbox.com/styles/v1/mapbox/streets-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZ2VvdGFiIiwiYSI6ImNpd2NlaW02MjAxc28yeW9idTR3dmRxdTMifQ.ZH0koA2g2YMMBOcx6EYbwQ").addTo(l),u=L.heatLayer({radius:{value:24,absolute:!1},opacity:.7,gradient:{.45:"rgb(0,0,255)",.55:"rgb(0,255,255)",.65:"rgb(0,255,0)",.95:"yellow",1:"rgb(255,0,0)"}}).addTo(l),d=document.getElementById("vehicles"),r=document.getElementById("from"),c=document.getElementById("to"),g=document.getElementById("error"),s=document.getElementById("loading");var t=new Date,n=t.getDate(),o=t.getMonth()+1,a=t.getFullYear();n<10&&(n="0"+n),o<10&&(o="0"+o),r.value=a+"-"+o+"-"+n+"T00:00",c.value=a+"-"+o+"-"+n+"T23:59",document.getElementById("vehicles").addEventListener("change",function(e){e.preventDefault(),v()}),document.getElementById("from").addEventListener("change",function(e){e.preventDefault(),v()}),document.getElementById("to").addEventListener("change",function(e){e.preventDefault(),v()})},n=function(e,t){return(e=e.name.toLowerCase())===(t=t.name.toLowerCase())?0:t<e?1:-1};return{initialize:function(e,t,n){console.log("initialize"),i=e,"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(e){console.log("geolocation"),o(e.coords),n()}):(o({longitude:-79.709441,latitude:43.434497}),n())},focus:function(e,t){for(i=e,console.log("focus");d.firstChild;)d.removeChild(d.firstChild);i.call("Get",{typeName:"Device",resultsLimit:1e3,search:{fromDate:(new Date).toISOString(),groups:t.getGroupFilter()}},function(e){!e||e.length<0||(e.sort(n),e.forEach(function(e){var t=new Option;t.text=e.name,t.value=e.id,d.add(t)}))},m),setTimeout(function(){l.invalidateSize()},200)}}};