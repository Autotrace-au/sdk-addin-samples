"use strict";geotab.addin.heatmap=function(){var e=void 0,t=void 0,n=void 0,a=void 0,o=void 0,i=void 0,d=void 0,l=void 0,u=function(e){d.innerHTML=e},r=function(e){e?l.style.display="block":setTimeout(function(){l.style.display="none"},600)},c=function(){var d=a.value,l=o.value,c=i.value;if(u(""),null!==d&&""!==l&&""!==c){r(!0);var m=new Date(l).toISOString(),g=new Date(c).toISOString();e.call("Get",{typeName:"LogRecord",resultsLimit:1e4,search:{deviceSearch:{id:d},fromDate:m,toDate:g}},function(e){for(var a=[],o=[],i=0;i<e.length;i++)0===e[i].latitude&&0===e[i].longitude||(a.push({lat:e[i].latitude,lon:e[i].longitude,value:1}),o.push(new L.LatLng(e[i].latitude,e[i].longitude)));a.length>0?(t.fitBounds(o),n.setLatLngs(a)):u("Not enough data to display"),r(!1)},function(e){u(e),r(!1)})}},m=function(e){t=new L.Map("heatmap-map").setView(new L.LatLng(e.latitude,e.longitude),13),L.tileLayer("https://api.mapbox.com/styles/v1/mapbox/streets-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZ2VvdGFiIiwiYSI6ImNpd2NlaW02MjAxc28yeW9idTR3dmRxdTMifQ.ZH0koA2g2YMMBOcx6EYbwQ").addTo(t),n=L.heatLayer({radius:{value:24,absolute:!1},opacity:.7,gradient:{.45:"rgb(0,0,255)",.55:"rgb(0,255,255)",.65:"rgb(0,255,0)",.95:"yellow",1:"rgb(255,0,0)"}}).addTo(t),a=document.getElementById("heatmap-vehicles"),o=document.getElementById("heatmap-from"),i=document.getElementById("heatmap-to"),d=document.getElementById("heatmap-error"),l=document.getElementById("heatmap-loading");var u=new Date,r=u.getDate(),m=u.getMonth()+1,g=u.getFullYear();r<10&&(r="0"+r),m<10&&(m="0"+m),o.value=g+"-"+m+"-"+r+"T00:00",i.value=g+"-"+m+"-"+r+"T23:59",document.getElementById("heatmap-vehicles").addEventListener("change",function(e){e.preventDefault(),c()}),document.getElementById("heatmap-from").addEventListener("change",function(e){e.preventDefault(),c()}),document.getElementById("heatmap-to").addEventListener("change",function(e){e.preventDefault(),c()})},g=function(e,t){return e=e.name.toLowerCase(),t=t.name.toLowerCase(),e===t?0:e>t?1:-1};return{initialize:function(t,n,a){e=t,"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(e){m(e.coords),a()}):(m({longitude:-79.709441,latitude:43.434497}),a())},focus:function(n){e=n,e.call("Get",{typeName:"Device",resultsLimit:1e3,search:{fromDate:(new Date).toISOString()}},function(e){!e||e.length<0||(e.sort(g),e.forEach(function(e){var t=new Option;t.text=e.name,t.value=e.id,a.add(t)}))},u),setTimeout(function(){t.invalidateSize()},200)}}};